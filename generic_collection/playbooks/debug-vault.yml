---
- hosts: localhost
  connection: local
  gather_facts: false
  vars:
    vault_file: "{{ playbook_dir }}/../inventory/vault.yml"
    target_switch: "sg3210-office"
  tasks:
    - name: Lade Vault
      include_vars:
        file: "{{ vault_file }}"
        name: vault_data
    
    - name: Debug - vault_data
      debug:
        var: vault_data
    
    - name: Debug - vault_passwords
      debug:
        var: vault_data.vault_passwords
    
    - name: Debug - spezifisches Passwort
      debug:
        msg: "PW für {{ target_switch }}: {{ vault_data.vault_passwords[target_switch] | default('NICHT GEFUNDEN') }}"
    
    - name: Debug - Finale Auflösung
      debug:
        msg: "Final: {{ vault_data.vault_passwords[target_switch] | default(vault_data.vault_default_password) | default('fallback') }}"
