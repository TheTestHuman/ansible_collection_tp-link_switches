---
- name: Configure Ports (BATCH) on SG3210
  hosts: managed_switches
  gather_facts: no
  connection: local
  
  vars:
    switch_host: "{{ ansible_host }}"
    switch_user: "admin"
    switch_pass: "neinnein"
    
    # Port-Konfiguration als strukturierte Daten
    port_configuration:
      trunk_ports:
        - port: 1
          vlans: "1,10,20,30,40"
      
      access_ports:
        - port: 2
          vlan: 10
        - port: 3
          vlan: 20
        - port: 4
          vlan: 20
        - port: 5
          vlan: 30
        - port: 6
          vlan: 30
        - port: 7
          vlan: 40
        - port: 8
          vlan: 40
  
  tasks:
    - name: Configure ALL ports in one batch
      tp_link_batch_port_expect:
        host: "{{ switch_host }}"
        username: "{{ switch_user }}"
        password: "{{ switch_pass }}"
        port_config: "{{ port_configuration }}"
        hostname: "SG3210"
      register: port_result
      
    - name: Show port batch result
      debug:
        msg: "Configured {{ port_result.ports_configured }} ports"
