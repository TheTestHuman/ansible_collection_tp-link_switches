---
- name: Configure Ports - ADD Mode
  hosts: managed_switches
  gather_facts: no
  connection: local
  
  vars:
    switch_host: "{{ ansible_host }}"
    switch_user: "admin"
    switch_pass: "neinnein"
    
    # Füge ZUSÄTZLICHE VLANs zu bestehenden hinzu
    additional_vlans:
      trunk_ports:
        - port: 1
          vlans: "30,40"  # Füge VLAN 30,40 zu bestehenden hinzu
      
      access_ports:
        - port: 4
          vlan: 30  # Ändere Port 4 auf VLAN 30
  
  tasks:
    - name: Add VLANs to ports (ADD mode)
      tp_link_batch_port_expect:
        host: "{{ switch_host }}"
        username: "{{ switch_user }}"
        password: "{{ switch_pass }}"
        port_config: "{{ additional_vlans }}"
        hostname: "SG3210"
        mode: add  # Füge zu bestehenden hinzu
        clear_existing: false  # Behalte alte VLANs
